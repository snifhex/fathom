

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Version History &mdash; Fathom 3.7 documentation</title>
  

  
  <link rel="stylesheet" href="_static/tweaks.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Glossary" href="glossary.html" />
    <link rel="prev" title="Example Ruleset" href="example.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Fathom
          

          
          </a>

          
            
            
              <div class="version">
                3.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="samples.html">Collecting Samples</a></li>
<li class="toctree-l1"><a class="reference internal" href="rules.html">Writing Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrating.html">Integrating</a></li>
<li class="toctree-l1"><a class="reference internal" href="zoo.html">Ruleset Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ruleset.html">Rules and Rulesets</a></li>
<li class="toctree-l1"><a class="reference internal" href="fnodes.html">Fnodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html">Clustering</a></li>
</ul>
<p class="caption"><span class="caption-text">Command Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="commands/extract.html">fathom extract</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/fox.html">fathom fox</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/histogram.html">fathom histogram</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/label.html">fathom label</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/list.html">fathom list</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/pick.html">fathom pick</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/serve.html">fathom serve</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/test.html">fathom test</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands/train.html">fathom train</a></li>
</ul>
<p class="caption"><span class="caption-text">Back Matter</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="example.html">Example Ruleset</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Fathom</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Version History</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/versions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="version-history">
<h1>Version History<a class="headerlink" href="#version-history" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>3.7<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fathom">
<h3>Fathom<a class="headerlink" href="#fathom" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="xref js js-meth docutils literal notranslate"><span class="pre">setCoeffsAndBiases()</span></code> is now a documented part of the public API.</p></li>
</ul>
</div>
<div class="section" id="fathomfox">
<h3>FathomFox<a class="headerlink" href="#fathomfox" title="Permalink to this headline">¶</a></h3>
<p>No changes.</p>
</div>
<div class="section" id="cli-tools">
<h3>CLI tools<a class="headerlink" href="#cli-tools" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Combine commandline tools into a single one called simply <code class="docutils literal notranslate"><span class="pre">fathom</span></code>. This makes the subcommands more discoverable.</p></li>
<li><p>Fix confusion matrix numbers, which have been wrong (if there were any pruned nodes) since we introduced pruned element detection in 3.5.</p></li>
<li><p>Fix autovectorization on Windows.</p></li>
<li><p>Whitelist a transient Vectorizer error that happens only on Windows.</p></li>
<li><p>Fix int32 overflow crashers in MCC calculations.</p></li>
<li><p>Implement a short-term workaround for the Vectorizer sometimes duplicating pages.</p></li>
</ul>
</div>
</div>
<div class="section" id="id2">
<h2>3.6<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id3">
<h3>Fathom<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Have <a class="reference internal" href="utilities.html#walk" title="walk"><code class="xref js js-func docutils literal notranslate"><span class="pre">walk()</span></code></a> default to walking all elements rather than insisting the caller provide a predicate.</p></li>
</ul>
</div>
<div class="section" id="id4">
<h3>FathomFox<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Make Vectorizer concurrency customizable.</p></li>
<li><p>Remove Retry checkbox from Vectorizer. We automatically do the right thing now.</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>CLI tools<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add the <a class="reference internal" href="commands/fox.html"><span class="doc">fathom-fox</span></a> command. This makes it more convenient for labelers to get FathomFox going in a blank Firefox profile, for those who have the commandline tools installed. Setting up a profile otherwise requires multiple steps and is easy to neglect.</p></li>
<li><p>Make the number of concurrent tabs during vectorization customizable, which can boost performance on big machines.</p></li>
<li><p>Fix a crash when <a class="reference internal" href="commands/train.html"><span class="doc">fathom-train</span></a> <code class="docutils literal notranslate"><span class="pre">-x</span></code> was used on a sample set that had premature prunings.</p></li>
<li><p>Color cells of the confusion matrix according to whether they’re good or bad.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">--feature</span></code> to <code class="docutils literal notranslate"><span class="pre">--rule</span></code> in <a class="reference internal" href="commands/histogram.html"><span class="doc">fathom-histogram</span></a> for consistency of vocabulary.</p></li>
</ul>
</div>
<div class="section" id="docs">
<h3>Docs<a class="headerlink" href="#docs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Modernize the docs and make them a chronological how-to.</p></li>
<li><p>Auto-extract reference docs for CLI tools.</p></li>
<li><p>Add canonical <a class="reference internal" href="example.html"><span class="doc">Example Ruleset</span></a> to the docs, since few have cause to check out the FathomFox source (where it lives) anymore.</p></li>
<li><p>Merge most of the FathomFox readme into the Sphinx docs.</p></li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h2>3.5<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>Fathom<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>No changes.</p>
</div>
<div class="section" id="id8">
<h3>FathomFox<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Record prematurely pruned elements. This bumps the vector version number to 2, which means previous versions of the commandline tools will not understand these new vector files.</p></li>
</ul>
</div>
<div class="section" id="id9">
<h3>CLI tools<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add <a class="reference internal" href="commands/histogram.html"><span class="doc">fathom-histogram</span></a> tool for examining the shapes of individual rule values.</p></li>
<li><p>Notice prematurely pruned elements during vectorization, and take them into account in training and testing metrics. Tag-level diagnostics in the trainer will show “pruned” for these elements so you can adjust your <a class="reference internal" href="ruleset.html#dom" title="dom"><code class="xref js js-func docutils literal notranslate"><span class="pre">dom()</span></code></a> calls if desired.</p></li>
<li><p>Replace F1 score with the Matthews Correlation Coefficient. MCC doesn’t assume same-sized classes (which Fathom problems never have) and also is not sensitive to which side of the problem you call “positive”.</p></li>
<li><p>Default to early stopping whenever a validation corpus is provided to <a class="reference internal" href="commands/train.html"><span class="doc">fathom-train</span></a>. After all, if you provide a validation corpus, it makes sense that we do something useful with it.</p></li>
<li><p>Add some <a class="reference internal" href="commands/extract.html"><span class="doc">fathom-extract</span></a> MIME types we discovered in a recent corpus.</p></li>
<li><p>Fix remaining divide-by-zero corner cases in the metrics code. (These would show up in toy corpora that were entirely lacking either positive or negative samples.)</p></li>
</ul>
</div>
</div>
<div class="section" id="id10">
<h2>3.4.1<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id11">
<h3>Fathom<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>No changes.</p>
</div>
<div class="section" id="id12">
<h3>FathomFox<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Have the Evaluator skip over <code class="docutils literal notranslate"><span class="pre">about:</span></code> tabs that used to crash it with permission problems.</p></li>
</ul>
</div>
<div class="section" id="id13">
<h3>CLI tools<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add confusion matrices to <a class="reference internal" href="commands/train.html"><span class="doc">fathom-train</span></a> and <a class="reference internal" href="commands/test.html"><span class="doc">fathom-test</span></a> readouts.</p></li>
<li><p>Catch JS syntax errors and other compile-time errors, and report them in <a class="reference internal" href="commands/train.html"><span class="doc">fathom-train</span></a> and <a class="reference internal" href="commands/test.html"><span class="doc">fathom-test</span></a>.</p></li>
<li><p>Catch errors due to the absence of prerequisite commands like <strong class="command">npm</strong>.</p></li>
<li><p>Catch and nicely report HTTP server errors during autovectorization rather than just spewing tracebacks. Add <code class="docutils literal notranslate"><span class="pre">--delay</span></code> option to <a class="reference internal" href="commands/train.html"><span class="doc">fathom-train</span></a> and <a class="reference internal" href="commands/test.html"><span class="doc">fathom-test</span></a> to work around them.</p></li>
<li><p>Don’t spit out <code class="docutils literal notranslate"><span class="pre">nan</span></code> for precision or F1 when we don’t get any samples right.</p></li>
</ul>
</div>
</div>
<div class="section" id="id14">
<h2>3.4<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p>Make vectorization automatic. This largely obsoletes <a class="reference internal" href="commands/list.html"><span class="doc">fathom-list</span></a> and <a class="reference internal" href="commands/serve.html"><span class="doc">fathom-serve</span></a>. We also remove the need to have 3 terminal tabs open, running <strong class="command">yarn watch</strong>, <strong class="command">yarn browser</strong>, and <a class="reference internal" href="commands/serve.html"><span class="doc">fathom-serve</span></a>. We remove the error-prone hardlinking of the ruleset into FathomFox, which breaks when git changes to a new branch with a changed ruleset file. We eliminate the possibility of forgetting to revectorize after changing a ruleset or samples. And finally, we pave the way to dramatically simplify our teaching and documentation.</p>
<p>We tried to hew to the CLI design of the previous version of the trainer to keep things familiar. Basically, where you used to pass in a vector file, now feel free to pass in a directory of samples instead. If you do, you’ll also need to pass in your ruleset file and the trainee ID so we can turn the samples into vectors behind the scenes. You can also keep passing in vector files manually if you want more control in some niche situation, like if you’re trying to reproduce results from an old branch.</p>
<p>Aggressive caching is in place to remove every possible impediment to using auto-vectorization. We store hashes of the ruleset and samples so we can tell when revectorizing is necessary. We also cache a built copy of FathomFox (embedded in the Python package) so we don’t need to run npm or yarn or hit the network again until you upgrade to a new version of the Fathom CLI tools.</p>
</li>
<li><p>When the Retry checkbox is checked in the Vectorizer, it now retries only errors it thinks are transient. This means you don’t have to wait 200 seconds for your syntax errors to bubble to the fore anymore.</p></li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">vectorType</span></code> optional in <code class="docutils literal notranslate"><span class="pre">rulesets.js</span></code> if it’s the same as the trainee ID.</p></li>
<li><p>Add an <code class="docutils literal notranslate"><span class="pre">--exclude</span></code> option to the trainer to help with feature ablation.</p></li>
<li><p>Fix an issue where the trainer would read vectors as non-UTF-8 on Windows.</p></li>
<li><p>In the trainer output, make tag excerpts that contain wide Unicode chars fit in their columns.</p></li>
<li><p>Don’t show tag excerpts in <a class="reference internal" href="commands/test.html"><span class="doc">fathom-test</span></a> by default.</p></li>
<li><p>Add application/x-javascript and application/font-sfnt to <a class="reference internal" href="commands/extract.html"><span class="doc">fathom-extract</span></a>’s list of known MIME types.</p></li>
<li><p>Merge FathomFox into the Fathom repo.</p></li>
<li><p>Always use in-project virtualenvs for development. Drop support for external ones.</p></li>
<li><p><a class="reference internal" href="utilities.html#isVisible" title="isVisible"><code class="xref js js-func docutils literal notranslate"><span class="pre">isVisible()</span></code></a> now considers things visible that are merely scrolled out of the viewport.</p></li>
<li><p><a class="reference internal" href="commands/list.html"><span class="doc">fathom-list</span></a>, though no longer needed in most cases, is now always recursive. It has also learned to ignore <code class="docutils literal notranslate"><span class="pre">resources</span></code> directories.</p></li>
<li><p><strong class="command">fathom-unzip</strong> is gone.</p></li>
</ul>
</div>
<div class="section" id="id15">
<h2>3.3<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Add to the trainer a readout of the average time per candidate tag examined.</p></li>
<li><p>Replace trainer’s per-page metrics, which were increasingly incoherent in Fathom 3, with per-tag ones. Per-page results were most useful back before Fathom could emit confidences. Now, most problems are concerned with per-tag accuracy, and problems that innately concern the page as a whole model it by scoring the <code class="docutils literal notranslate"><span class="pre">&lt;html&gt;</span></code> tag. Thus, we swap out the old per-page report for a per-tag one. This is a superset of the per-page report.</p></li>
<li><p>Add a confidence-threshold customization option to fathom-train.</p></li>
<li><p>Add <a class="reference internal" href="ruleset.html#element" title="element"><code class="xref js js-func docutils literal notranslate"><span class="pre">element()</span></code></a>, which lets you efficiently classify a single element. This is useful for applications in which you want Fathom to classify an element the user has selected, rather than scanning the whole page for candidates.</p></li>
</ul>
</div>
<div class="section" id="id16">
<h2>3.2.1<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Make the cache that powers <code class="xref js js-func docutils literal notranslate"><span class="pre">fnodeForElement()</span></code> a <code class="docutils literal notranslate"><span class="pre">WeakMap</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">Map</span></code>. This will save memory if you keep a <a class="reference internal" href="ruleset.html#BoundRuleset" title="BoundRuleset"><code class="xref js js-class docutils literal notranslate"><span class="pre">BoundRuleset()</span></code></a> around a long time and DOM elements it has recognized get deleted from the page.</p></li>
<li><p>Tweak some indentation in the trainer coefficient output.</p></li>
<li><p>Upgrade Jinja to fix a security bug during doc build.</p></li>
</ul>
</div>
<div class="section" id="id17">
<h2>3.2<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Add <a class="reference internal" href="commands/test.html"><span class="doc">fathom-test</span></a> tool for computing test-corpus accuracies.</p></li>
<li><p>Add <a class="reference internal" href="commands/extract.html"><span class="doc">fathom-extract</span></a> to break down frozen pages into small enough pieces to check into GitHub.</p></li>
<li><p>Add <a class="reference internal" href="commands/serve.html"><span class="doc">fathom-serve</span></a> to dodge the CORS errors that otherwise happen when loading extracted pages.</p></li>
<li><p>Add a test harness for the Python code.</p></li>
<li><p>Make <a class="reference internal" href="utilities.html#isVisible" title="isVisible"><code class="xref js js-func docutils literal notranslate"><span class="pre">isVisible()</span></code></a> more correct and, in Firefox, 13% less janky.</p></li>
<li><p>Add in-browser test harness for routines that need a real DOM.</p></li>
<li><dl class="simple">
<dt>Revamp build process.</dt><dd><ul>
<li><p>The makefile is now the One True Entrypoint for build stuff. There are no more npm scripts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> now runs all the tests, even the browser ones.</p></li>
<li><p>The browser tests now work on Windows.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">lint</span></code> lints all languages. <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">py_lint</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">js_lint</span></code> lint 1 each.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">py_test</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">js_test</span></code> test 1 language each.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span></code> takes care of making a venv for you (in the top level of the checkout) whenever it needs one. If you have an existing one activated before you make, it’ll use yours instead.</p></li>
<li><p>New Python dependencies are automatically installed at the next <code class="docutils literal notranslate"><span class="pre">make</span></code> whenever they’re added to requirements files or setup.py. Note that you’ll see occasional spurious package installation attempts after you change branches, because the branch change causes the mod dates of files to be reset to the current time. But the attempts are reasonably quick and idempotent.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> is run automatically whenever package.json has been updated.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">doc</span></code> from the top level now builds the docs.</p></li>
<li><p>A failing doc build will now fail the CI tests, so we don’t get surprised on master anymore.</p></li>
<li><p>As a bonus, pip-installing fathom-web now works on Windows.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Remove the Readability tests, which were too slow for their small utility.</p></li>
<li><p>Remove the old optimizer, which was used only by the Readability tests.</p></li>
<li><p>Add confidence intervals for false positives and false negatives in trainer.</p></li>
<li><p>Add precision and recall numbers to trainer.</p></li>
<li><dl class="simple">
<dt>Redesign Fathom bundle.</dt><dd><ul>
<li><p>It now works as a part of Firefox itself.</p></li>
<li><p>It provides a way to access submodules like <code class="docutils literal notranslate"><span class="pre">utils</span></code> and <code class="docutils literal notranslate"><span class="pre">clusters</span></code>, which node would typically import via filesystem paths.</p></li>
<li><p>Removed wu, the sole runtime dependency.</p></li>
<li><p>Drop unminified size from 237K to 105K.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Add optional positive-sample weighting in trainer, for trading off between precision and recall.</p></li>
<li><p>Add experimental support for deeper neural networks in trainer.</p></li>
<li><p>Add recognition-time speed metrics to trainer.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Backward-incompatible change: The <code class="docutils literal notranslate"><span class="pre">clusters</span></code> symbol exported from Fathom’s top level is now a module containing all the <a class="reference internal" href="clustering.html"><span class="doc">Clustering</span></a> routines, not <a class="reference internal" href="clustering.html#clusters" title="clusters"><code class="xref js js-func docutils literal notranslate"><span class="pre">clusters()</span></code></a> itself. The <a class="reference internal" href="clustering.html#clusters" title="clusters"><code class="xref js js-func docutils literal notranslate"><span class="pre">clusters()</span></code></a> function is now at <code class="docutils literal notranslate"><span class="pre">clusters.clusters</span></code>.</p>
</div>
</div>
<div class="section" id="id18">
<h2>3.1<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Make BAD-element-labeling reliable when using FathomFox to debug rulesets.</p></li>
<li><p>Add <a class="reference internal" href="commands/list.html"><span class="doc">fathom-list</span></a> tool.</p></li>
<li><p>Further optimize trainer: about 17x faster for a 60-sample corpus, with superlinear improvements for larger ones.</p></li>
</ul>
</div>
<div class="section" id="id19">
<h2>3.0<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h2>
<p>3.0 brings to bear simple neural nets, yielding…</p>
<ul class="simple">
<li><p>Faster training by several orders of magnitude</p></li>
<li><p>More accurate training, guaranteed to converge to at least a local minimum</p></li>
<li><p>Lower RAM use during training, by several orders of magnitude, uncapping corpus size. You should now be able to train on a corpus of 200,000 samples in 1GB of RAM.</p></li>
<li><p>Confidence calculations for free. A score now represents the probability that a node belongs to a given type, informed by statistics (binary cross-entropy) run over the training corpus. If you’ve been using 0..1 fuzzy-logic value in your scoring callbacks, you’re already most of the way there. Just strip away any manual weighting, and you’re done.</p></li>
<li><p>Coefficients have been moved into the framework: no more multiplying or exponentiating yourself. Bias values have been added to make confidences work out.</p></li>
</ul>
<p>Essentially, 3.0 recasts the Fathom recognition problem as a classification one, turning each Fathom type into a perceptron and each rule into one of its input features. (We were close already, mathematically; we just had to switch multiplicative mixing to additive and add a bias.) Besides gaining the advantage of a great deal of existing literature and off-the-shelf tooling, it means Fathom is no longer practically limited to grabbing the single most likely member of a class from a page. It can grab all that exist, and confidence calculations inform the caller when to stop believing its guesses.</p>
<div class="section" id="backward-incompatible-changes">
<h3>Backward-incompatible changes<a class="headerlink" href="#backward-incompatible-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="xref js js-func docutils literal notranslate"><span class="pre">conserveScore()</span></code> is gone, at least for now.</p></li>
<li><p><a class="reference internal" href="ruleset.html#ruleset" title="ruleset"><code class="xref js js-func docutils literal notranslate"><span class="pre">ruleset()</span></code></a> takes its rules in an array rather than as varargs, making room to pass in coefficients and biases.</p></li>
<li><p>Scores are no longer multiplied together. They are now added and then run through a <a class="reference internal" href="utilities.html#sigmoid" title="sigmoid"><code class="xref js js-func docutils literal notranslate"><span class="pre">sigmoid()</span></code></a> function, which, combined with the math in the new trainer, makes them probabilities.</p></li>
</ul>
</div>
<div class="section" id="other-specific-changes">
<h3>Other specific changes<a class="headerlink" href="#other-specific-changes" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The annealing optimizer is deprecated. Training is now purview of the commandline <a class="reference internal" href="commands/train.html"><span class="doc">fathom-train</span></a> tool.</p></li>
<li><p>Add <strong class="command">fathom-unzip</strong> and <a class="reference internal" href="commands/pick.html"><span class="doc">fathom-pick</span></a> tools for corpus management.</p></li>
<li><p>Fix the bad-element labeling in FathomFox (by fixing a file compiled into fathom-trainees).</p></li>
<li><p>Add utility functions <a class="reference internal" href="utilities.html#isVisible" title="isVisible"><code class="xref js js-func docutils literal notranslate"><span class="pre">isVisible()</span></code></a>, <a class="reference internal" href="utilities.html#rgbaFromString" title="rgbaFromString"><code class="xref js js-func docutils literal notranslate"><span class="pre">rgbaFromString()</span></code></a>, <a class="reference internal" href="utilities.html#saturation" title="saturation"><code class="xref js js-func docutils literal notranslate"><span class="pre">saturation()</span></code></a>, <a class="reference internal" href="utilities.html#sigmoid" title="sigmoid"><code class="xref js js-func docutils literal notranslate"><span class="pre">sigmoid()</span></code></a>, and <a class="reference internal" href="utilities.html#linearScale" title="linearScale"><code class="xref js js-func docutils literal notranslate"><span class="pre">linearScale()</span></code></a>.</p></li>
<li><p>Allow <a class="reference internal" href="clustering.html#euclidean" title="euclidean"><code class="xref js js-func docutils literal notranslate"><span class="pre">euclidean()</span></code></a> to take HTML elements in addition to fnodes.</p></li>
<li><p>Accept boolean return values from <a class="reference internal" href="ruleset.html#score" title="score"><code class="xref js js-func docutils literal notranslate"><span class="pre">score()</span></code></a> callbacks, which get cast to 0 or 1.</p></li>
</ul>
</div>
</div>
<div class="section" id="id20">
<h2>2.8<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Add the ability to label wrongly recognized elements to fathom-trainees imports, for use with FathomFox 2.3 and above.</p></li>
</ul>
</div>
<div class="section" id="id21">
<h2>2.7<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Add support for pluggable success functions in fathom-trainees.</p></li>
</ul>
</div>
<div class="section" id="id22">
<h2>2.6<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Factor some boilerplate out of the fathom-trainees web extension into Fathom
itself. Now, after you fork fathom-trainees, you’ll rarely have to change
anything to stay up to date.</p></li>
</ul>
</div>
<div class="section" id="id23">
<h2>2.5<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Add experimental <a class="reference internal" href="ruleset.html#nearest" title="nearest"><code class="xref js js-func docutils literal notranslate"><span class="pre">nearest()</span></code></a> function, our first primitive for tying together compound entities.</p></li>
<li><p>Add <a class="reference internal" href="clustering.html#euclidean" title="euclidean"><code class="xref js js-func docutils literal notranslate"><span class="pre">euclidean()</span></code></a> distance function, a strong source of signal on rendered pages.</p></li>
<li><p>Improve speed of <a class="reference internal" href="utilities.html#rootElement" title="rootElement"><code class="xref js js-func docutils literal notranslate"><span class="pre">rootElement()</span></code></a>.</p></li>
</ul>
</div>
<div class="section" id="id24">
<h2>2.4<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Fathom is now a <a class="reference external" href="https://medium.com/&#64;giltayar/native-es-modules-in-nodejs-status-and-future-directions-part-i-ee5ea3001f71">dual-mode</a> package, exposing both ES6 modules and equivalent CommonJS ones. This lets us <code class="docutils literal notranslate"><span class="pre">import</span></code> Fathom into modern ES6 projects and enjoy rollup’s dead-code elimination while still remaining <code class="docutils literal notranslate"><span class="pre">require()</span></code>-able by old CommonJS code.</p></li>
<li><p>Nudge people toward <a class="reference external" href="https://addons.mozilla.org/en-US/firefox/addon/fathomfox/">FathomFox</a> rather than writing custom code against the optimization framework.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Backward-incompatible change: There is no longer a <code class="docutils literal notranslate"><span class="pre">utils</span></code> property exported by Fathom’s top level. Instead, add imports like <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">{ancestors}</span> <span class="pre">from</span> <span class="pre">'fathom-web/utilsForFrontend';</span></code> or <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">{staticDom}</span> <span class="pre">from</span> <span class="pre">'fathom-web/utilsForBackend';</span></code> or the equivalent <code class="docutils literal notranslate"><span class="pre">require()</span></code> calls. There still exists a combined <code class="docutils literal notranslate"><span class="pre">utils</span></code> module importable from <code class="docutils literal notranslate"><span class="pre">fathom-web/utils</span></code> as well, though rollup’s dead-code elimination has trouble with it.</p>
</div>
</div>
<div class="section" id="id26">
<h2>2.3<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Add Corpus Framework to further assist you in doing ruleset optimization.</p></li>
<li><p>Improve the optimizer’s speed by about 4x.</p></li>
<li><p>Change jsdom from a devDependency to a proper dependency. It’s still used only from <code class="xref js js-func docutils literal notranslate"><span class="pre">staticDom()</span></code>, which is generally used only while authoring a ruleset. Bundlers (used to pack Fathom into a webextension, for instance) should throw it away in their dead code elimination phase. See, for example, the included experimental <a class="reference external" href="https://rollupjs.org/">rollup</a> configuration.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Backward-incompatible change: <a class="reference internal" href="utilities.html#attributesMatch" title="attributesMatch"><code class="xref js js-func docutils literal notranslate"><span class="pre">attributesMatch()</span></code></a> now takes an HTML element as its first parameter, not a <a class="reference internal" href="fnodes.html#Fnode" title="Fnode"><code class="xref js js-class docutils literal notranslate"><span class="pre">Fnode()</span></code></a>. This makes it usable in more situations. Bring your uses up to date by sticking <code class="docutils literal notranslate"><span class="pre">.element</span></code> after your first params.</p>
</div>
</div>
<div class="section" id="id27">
<h2>2.2<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Generalize the computation of rule prerequisites, eliminating many special cases. As a bonus, <cite>and(type(‘A’)) -&gt; type(‘A’)</cite> now gets an optimal query plan.</p></li>
<li><p>Add an <cite>additionalCost</cite> coefficient to <a class="reference internal" href="clustering.html#distance" title="distance"><code class="xref js js-func docutils literal notranslate"><span class="pre">distance()</span></code></a> so you can hook your own math into it.</p></li>
<li><p>Add <a class="reference internal" href="ruleset.html#when" title="when"><code class="xref js js-func docutils literal notranslate"><span class="pre">when()</span></code></a> call for filtering by arbitrary conditions in left-hand sides.</p></li>
<li><p>Add <a class="reference internal" href="utilities.html#attributesMatch" title="attributesMatch"><code class="xref js js-func docutils literal notranslate"><span class="pre">attributesMatch()</span></code></a> utility function for applying tests to element attribute values.</p></li>
<li><p>Update to the latest (backward-incompatible) version of jsdom in the test harness, and modify callsite accordingly.</p></li>
<li><p>Exclude documentation source from the built package, dropping its unpacked size by 90K.</p></li>
</ul>
</div>
<div class="section" id="id28">
<h2>2.1<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<p>Clustering as a first-class construct, full docs, and automatic optimization of score coefficients headline this release.</p>
<div class="section" id="clustering">
<h3>Clustering<a class="headerlink" href="#clustering" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Make clustering available <em>within</em> a ruleset rather than just as an imperative sidecar, via <a class="reference internal" href="ruleset.html#bestCluster" title="bestCluster"><code class="xref js js-func docutils literal notranslate"><span class="pre">bestCluster()</span></code></a>.</p></li>
<li><p>Let costs be passed into <a class="reference internal" href="clustering.html#distance" title="distance"><code class="xref js js-func docutils literal notranslate"><span class="pre">distance()</span></code></a> and <a class="reference internal" href="clustering.html#clusters" title="clusters"><code class="xref js js-func docutils literal notranslate"><span class="pre">clusters()</span></code></a> so we can tune them per ruleset.</p></li>
<li><p>Make clustering about 26% faster.</p></li>
<li><p>Let <a class="reference internal" href="clustering.html#clusters" title="clusters"><code class="xref js js-func docutils literal notranslate"><span class="pre">clusters()</span></code></a> and <a class="reference internal" href="clustering.html#distance" title="distance"><code class="xref js js-func docutils literal notranslate"><span class="pre">distance()</span></code></a> optionally take <a class="reference internal" href="glossary.html#term-fnode"><span class="xref std std-term">fnodes</span></a> instead of raw DOM nodes.</p></li>
<li><p>Revise clustering <a class="reference internal" href="clustering.html#distance" title="distance"><code class="xref js js-func docutils literal notranslate"><span class="pre">distance()</span></code></a> function to not crash if node A is within node B and to return MAX_VALUE if there is any container relationship. This should make Readability-like clustering algorithms work out nicely, since we’re interested only in the outer nodes. Pushing the inner ones off to the edge of the world removes them from being considered when we go to paste the largest cluster back together.</p></li>
<li><p>Skip the expensive stride node computation during clustering if you pass 0 as its coefficient.</p></li>
</ul>
</div>
<div class="section" id="more">
<h3>More<a class="headerlink" href="#more" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Add nice documentation using Sphinx.</p></li>
<li><p>Add score optimization machinery based on simulated annealing. This seems to do well on stepwise functions, where Powell’s and other continuous methods get hung up on the flats.</p></li>
<li><p>Add a Readability-alike content-extraction ruleset as an example.</p></li>
<li><p>Add .babelrc file so Fathom can be used as a dep in webpack/Babel projects. (jezell)</p></li>
<li><p>Add <a class="reference internal" href="ruleset.html#allThrough" title="allThrough"><code class="xref js js-func docutils literal notranslate"><span class="pre">allThrough()</span></code></a>, which comes in handy for sorting the nodes of a cluster.</p></li>
<li><p>Get the Chrome debugger working with our tests again (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">debugtest</span></code>).</p></li>
<li><p>Officially support operating on DOM subtrees (which did work previously).</p></li>
<li><p>Fix <a class="reference internal" href="utilities.html#linkDensity" title="linkDensity"><code class="xref js js-func docutils literal notranslate"><span class="pre">linkDensity()</span></code></a> utility function that wouldn’t run. Remove hard-coded type from it.</p></li>
</ul>
</div>
</div>
<div class="section" id="id29">
<h2>2.0<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h2>
<p>The focii for 2.0 are syntactic sugar and support for larger, more powerful rulesets that can operate at higher levels of abstraction. From these priorities spring all of the following:</p>
<ul>
<li><p>“Yankers” or aggregate functions are now part of the ruleset: <a class="reference internal" href="utilities.html#max" title="max"><code class="xref js js-func docutils literal notranslate"><span class="pre">max()</span></code></a> and <a class="reference internal" href="ruleset.html#and" title="and"><code class="xref js js-func docutils literal notranslate"><span class="pre">and()</span></code></a> for now, with more in a later release. This in-ruleset mapping from the fuzzy domain of scores back to the boolean domain of types complements the opposite mapping provided by <a class="reference internal" href="ruleset.html#score" title="score"><code class="xref js js-func docutils literal notranslate"><span class="pre">score()</span></code></a> and lets ruleset authors choose between efficiency and completeness. It also saves imperative programming where maxima are referenced from more than one place. Finally, it opens the door to automatic optimization down the road.</p></li>
<li><p>Answers are computed lazily, running only the necessary rules each time you call <a class="reference internal" href="ruleset.html#BoundRuleset.get" title="BoundRuleset.get"><code class="xref js js-func docutils literal notranslate"><span class="pre">get()</span></code></a> and caching intermediate results to save work on later calls. We thus eschew 1.x’s strategy of emitting the entire scored world for the surrounding imperative program to examine and instead expose a factbase that acts like a lazy hash of answers. This allows for large, sophisticated rulesets that are nonetheless fast and can be combined to reuse parts (see <a class="reference internal" href="ruleset.html#Ruleset.rules" title="Ruleset.rules"><code class="xref js js-func docutils literal notranslate"><span class="pre">Ruleset.rules()</span></code></a>). Of course, if you still want to imbibe the entire scored corpus of nodes in your surrounding program, you can simply yank all nodes of a type using the <a class="reference internal" href="ruleset.html#type" title="type"><code class="xref js js-func docutils literal notranslate"><span class="pre">type()</span></code></a> yanker: just point it to <a class="reference internal" href="ruleset.html#out" title="out"><code class="xref js js-func docutils literal notranslate"><span class="pre">out()</span></code></a>, and the results will be available from the outside: <code class="docutils literal notranslate"><span class="pre">rule(type('foo'),</span> <span class="pre">out('someKey'))</span></code>.</p></li>
<li><p>We expand the domain of concern of a ruleset from a single dimension (“Find just the ads!”) to multiple ones (“Find the ads and the navigation and the products and the prices!”). This is done by making scores and notes per-type.</p></li>
<li><p>The rule syntax has been richly sugared
to…</p>
<blockquote>
<div><ul class="simple">
<li><p>be shorter and easier to read in most cases</p></li>
<li><p>surface more info declaratively so the query planner can take advantage of it (<a class="reference internal" href="ruleset.html#props" title="props"><code class="xref js js-func docutils literal notranslate"><span class="pre">props()</span></code></a> is where the old-style ranker functions went, but avoid them when you don’t need that much power, and you’ll reap a reward of concision and efficiently planned queries)</p></li>
<li><p>allow you to concisely factor up repeated parts of complex LHSs and RHSs</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The new experimental <a class="reference internal" href="ruleset.html#and" title="and"><code class="xref js js-func docutils literal notranslate"><span class="pre">and()</span></code></a> combinator allows you to build more powerful abstractions upon the black boxes of types.</p></li>
<li><p>Test coverage is greatly improved, and eslint is keeping us from doing overtly stupid things.</p></li>
</ul>
<div class="section" id="id30">
<h3>Backward-incompatible changes<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>RHSs (née ranker functions) can no longer return multiple facts, which simplifies both syntax and design. For now, use multiple rules, each emitting one fact, and share expensive intermediate computations in notes. If this proves a problem in practice, we’ll switch back, but I never saw anyone return multiple facts in the wild.</p></li>
<li><p>Scores are now per-type. This lets you deliver multiple independent scores per ruleset. It also lets Fathom optimize out downstream rules in many cases, since downstream rules’ scores no longer back-propagate to upstream types. Per-type scores also enable complex computations with types as composable units of abstraction, open the possibility of over-such-and-such-a-score yankers, and make non-multiplication-based score components a possibility. However, the old behavior remains largely available via <code class="xref js js-func docutils literal notranslate"><span class="pre">conserveScore()</span></code>.</p></li>
<li><p>Flavors are now types.</p></li>
</ul>
</div>
</div>
<div class="section" id="id31">
<h2>1.1.2<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Stop assuming querySelectorAll() results conform to the iterator protocol. This fixes compatibility with Chrome.</p></li>
<li><p>Add test coverage reporting.</p></li>
</ul>
</div>
<div class="section" id="id32">
<h2>1.1.1<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>No changes. Just bump the version in an attempt to get the npm index page to update.</p></li>
</ul>
</div>
<div class="section" id="id33">
<h2>1.1<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Stop using <code class="docutils literal notranslate"><span class="pre">const</span></code> in <code class="docutils literal notranslate"><span class="pre">for...of</span></code> loops. This lets Fathom run within Firefox, which does not allow this due to a bug in its ES implementation.</p></li>
<li><p>Optimize DistanceMatrix.numClusters(), which should make clustering a bit faster.</p></li>
</ul>
</div>
<div class="section" id="id34">
<h2>1.0<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Initial release</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="glossary.html" class="btn btn-neutral float-right" title="Glossary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="example.html" class="btn btn-neutral float-left" title="Example Ruleset" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017-2019, Mozilla Foundation

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>